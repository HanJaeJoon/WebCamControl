@page
@model IndexModel

<!DOCTYPE html>
<html>
<body>
    <div id="camera-preview" style="width: 1280px; height: 720px;">
        <video playsinline="playsinline" style="width: 1280px; height: 720px;"></video>
    </div>
    <button id="btn-take-picture">Take Picture</button>
    <div id="picture-list" style="width: 1280px; height: 720px;">
    </div>
</body>
<script src="~/js/webcam.js"></script>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', async () => {
        //const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 1280, height: 720 } });
        //const video = document.querySelector('video');

        //video.srcObject = stream;

        navigator.mediaDevices?.enumerateDevices()
            .then(devices => {
                for (let i = 0; i < devices.length; i++) {
                    const device = devices[i];

                    if (device.label?.toLowerCase()?.includes('fuji')) {
                        Webcam.set({
                            width: 720,
                            //width: 1280,
                            height: 720,
                            image_format: 'jpeg',
                            jpeg_quality: 100,
                            //constraints: {
                            //    width: { exact: 1280 },
                            //    height: { exact: 720 },
                            //},
                            deviceId: { exact: device.deviceId, },
                            flip_horiz: true,
                        });

                        Webcam.attach('#camera-preview');
                    }
                };
            })
            .catch(err => {
                console.log(err);
            });

        document.querySelector('#btn-take-picture').addEventListener('click', () => {
            Webcam.snap(function (uri) {
                document.querySelector('#picture-list').innerHTML += `<div><img src="${uri}" /></div>`;
            });
        });
    });
</script>
</html>